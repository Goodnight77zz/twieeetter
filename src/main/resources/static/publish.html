<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>
        <span class="cn">å‘å¸ƒç ”ç©¶ - åˆ›ä½œä¸­å¿ƒ</span>
        <span class="en">Publish Research - Creator Center</span>
    </title>
    <!-- å¼•å…¥é€šç”¨è¯­è¨€ç»„ä»¶CSS -->
    <link rel="stylesheet" href="common/lang-component.css">
    <style>
        /* å¤ç”¨åŸºç¡€å¸ƒå±€ CSS */
        body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; background-color: #f4f5f7; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 240px; background: white; border-right: 1px solid #e7e7e7; display: flex; flex-direction: column; padding: 20px 0; flex-shrink: 0; }
        .logo { padding: 0 24px 20px; font-size: 22px; font-weight: 900; color: #00a1d6; border-bottom: 1px solid #eee; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;}
        .post-btn-container { padding: 0 20px; margin-bottom: 20px; }
        .big-post-btn { width: 100%; background-color: #00a1d6; color: white; border: none; padding: 12px; border-radius: 4px; font-size: 16px; cursor: pointer; display: flex; justify-content: center; align-items: center; font-weight: bold; text-decoration: none; box-sizing: border-box;}
        .menu-item { padding: 12px 24px; color: #505050; text-decoration: none; font-size: 15px; display: flex; align-items: center; transition: background 0.2s; }
        .menu-item:hover { background-color: #f4f5f7; color: #00a1d6; }
        .menu-icon { margin-right: 10px; font-size: 18px; width: 20px; text-align: center;}

        .main-content { flex: 1; padding: 30px; overflow-y: auto; background-color: #f4f5f7; }

        /* === å‘å¸ƒè¡¨å•åŒºåŸŸ === */
        .editor-container { background: white; max-width: 800px; margin: 0 auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); padding: 40px; }
        .page-header { border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 30px; }
        .page-header h2 { margin: 0; color: #333; font-size: 24px; }

        .form-group { margin-bottom: 25px; }
        .form-label { display: block; margin-bottom: 10px; font-weight: bold; color: #444; }

        textarea { width: 100%; height: 200px; border: 1px solid #ddd; border-radius: 4px; padding: 15px; font-size: 16px; font-family: inherit; resize: vertical; outline: none; box-sizing: border-box; transition: border 0.2s;}
        textarea:focus { border-color: #00a1d6; }

        .file-upload-box { border: 2px dashed #ddd; border-radius: 4px; padding: 40px; text-align: center; background-color: #fafafa; cursor: pointer; transition: all 0.2s; }
        .file-upload-box:hover { border-color: #00a1d6; background-color: #f0faff; }
        .upload-icon { font-size: 40px; color: #999; margin-bottom: 10px; display: block; }
        .upload-text { color: #666; }
        #fileNameDisplay { margin-top: 10px; color: #00a1d6; font-weight: bold; }

        .action-bar { margin-top: 40px; text-align: right; border-top: 1px solid #eee; padding-top: 20px; }
        .submit-btn { background-color: #00a1d6; color: white; border: none; padding: 12px 40px; border-radius: 4px; font-size: 16px; cursor: pointer; font-weight: bold; }
        .submit-btn:hover { background-color: #00b5e5; }
    </style>
</head>
<body>

<!-- ä¾§è¾¹æ  (ä¿æŒä¸€è‡´) -->
<div class="sidebar">
    <div class="logo">ğŸŒŠ
        <span class="cn">åˆ›ä½œä¸­å¿ƒ</span>
        <span class="en">Creator Center</span>
    </div>

    <div class="post-btn-container">
        <!-- å½“å‰é¡µé¢æ˜¯å‘å¸ƒé¡µï¼ŒæŒ‰é’®ç¨å¾®å˜ä¸€ä¸‹æ ·å¼æˆ–è€…ç¦ç”¨ï¼Œè¿™é‡Œä¿æŒé“¾æ¥æ–¹ä¾¿åˆ·æ–° -->
        <a href="publish.html" class="big-post-btn" style="background-color:#00b5e5;">
            ğŸ“
            <span class="cn">å‘å¸ƒæ–°ç ”ç©¶</span>
            <span class="en">Publish New Research</span>
        </a>
    </div>

    <a href="dashboard.html" class="menu-item">
        <span class="menu-icon">ğŸ </span>
        <span class="cn">é¦–é¡µ</span>
        <span class="en">Home</span>
    </a>
    <a href="index.html" class="menu-item">
        <span class="menu-icon">ğŸŒ</span>
        <span class="cn">è¿”å›å¹¿åœº</span>
        <span class="en">Back to Plaza</span>
    </a>
    <!-- å…¶ä»–èœå•çœç•¥... -->
</div>

<!-- ä¸»ç¼–è¾‘åŒº -->
<div class="main-content">
    <div class="editor-container">
        <div class="page-header">
            <h2>
                <span class="cn">å‘å¸ƒç ”ç©¶æˆæœ</span>
                <span class="en">Publish Research Achievement</span>
            </h2>
        </div>

        <div class="form-group">
            <label class="form-label">
                <span class="cn">ç ”ç©¶æè¿° / æ‘˜è¦</span>
                <span class="en">Research Description / Abstract</span>
            </label>
            <textarea id="tweetContent" placeholder="è¯·è¾“å…¥è®ºæ–‡çš„æ ‡é¢˜ã€æ‘˜è¦æˆ–ä¸»è¦ç ”ç©¶æˆæœè¯´æ˜..." data-placeholder-en="Please enter the paper's title, abstract or main research achievements..."></textarea>
        </div>

        <div class="form-group">
            <label class="form-label">
                <span class="cn">ä¸Šä¼ é™„ä»¶ (è®ºæ–‡/æ–‡æ¡£)</span>
                <span class="en">Upload Attachment (Paper/Document)</span>
            </label>
            <!-- ç‚¹å‡»è¿™ä¸ªå¤§æ¡†æ¡†è§¦å‘æ–‡ä»¶é€‰æ‹© -->
            <div class="file-upload-box" onclick="document.getElementById('paperFile').click()">
                <span class="upload-icon">â˜ï¸</span>
                <div class="upload-text">
                    <span class="cn">ç‚¹å‡»æ­¤å¤„ä¸Šä¼ æ–‡ä»¶ (æ”¯æŒ PDF, Word)</span>
                    <span class="en">Click here to upload files (Supports PDF, Word)</span>
                </div>
                <div id="fileNameDisplay"></div>
            </div>
            <!-- éšè—çš„ input -->
            <input type="file" id="paperFile" accept=".pdf,.doc,.docx" style="display: none;" onchange="showFileName()">
        </div>

        <div class="action-bar">
            <button class="submit-btn" onclick="postTweet()">
                <span class="cn">ç«‹å³å‘å¸ƒ</span>
                <span class="en">Publish Now</span>
            </button>
        </div>
    </div>
</div>

<!-- é€šç”¨è¯­è¨€åˆ‡æ¢ç»„ä»¶HTML -->
<div class="lang-selector" id="langSelector">
    <button class="lang-trigger" id="langTrigger">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 21l5.25-11.25L21 21m-9-3h7.5M3 10.5h7.5M13.5 3H3v7.5" />
        </svg>
    </button>
    <div class="lang-dropdown">
        <button class="lang-option" id="langCn" onclick="switchLang('cn')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
            </svg>
            ä¸­æ–‡
        </button>
        <button class="lang-option" id="langEn" onclick="switchLang('en')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
            </svg>
            English
        </button>
    </div>
</div>

<!-- å¼•å…¥é€šç”¨è¯­è¨€ç»„ä»¶JS -->
<script src="common/lang-component.js"></script>

<script>
    const userId = localStorage.getItem("userId");
    // å½“å‰è¯­è¨€çŠ¶æ€
    let currentLang = localStorage.getItem('appLang') || 'cn';

    if(!userId) window.location.href = "login.html";

    // ç›‘å¬è¯­è¨€åˆ‡æ¢äº‹ä»¶ï¼Œæ›´æ–°é¡µé¢æ–‡æœ¬
    window.addEventListener('languageChange', function() {
        currentLang = localStorage.getItem('appLang') || 'cn';
        updateFormText();
    });

    // æ›´æ–°è¡¨å•æ–‡æœ¬ï¼ˆè¯­è¨€åˆ‡æ¢æ—¶è°ƒç”¨ï¼‰
    function updateFormText() {
        // ç ”ç©¶æè¿°è¾“å…¥æ¡†å ä½ç¬¦
        const contentInput = document.getElementById("tweetContent");
        const cnPlaceholder = contentInput.getAttribute("placeholder");
        const enPlaceholder = contentInput.getAttribute("data-placeholder-en");
        contentInput.placeholder = currentLang === 'cn' ? cnPlaceholder : enPlaceholder;

        // ä¸Šä¼ åŒºåŸŸæ–‡æœ¬
        const uploadText = document.querySelector(".upload-text");
        uploadText.innerHTML = `
            <span class="cn">ç‚¹å‡»æ­¤å¤„ä¸Šä¼ æ–‡ä»¶ (æ”¯æŒ PDF, Word)</span>
            <span class="en">Click here to upload files (Supports PDF, Word)</span>
        `;

        // å·²é€‰æ‹©æ–‡ä»¶æ–‡æœ¬ï¼ˆå¦‚æœæœ‰æ–‡ä»¶ï¼‰
        const fileNameDisplay = document.getElementById("fileNameDisplay");
        if (fileNameDisplay.innerText) {
            const originalText = fileNameDisplay.innerText.replace(/^å·²é€‰æ‹©: /, '').replace(/^Selected: /, '');
            fileNameDisplay.innerText = currentLang === 'cn' ? `å·²é€‰æ‹©: ${originalText}` : `Selected: ${originalText}`;
        }

        // æäº¤æŒ‰é’®æ–‡æœ¬
        const submitBtn = document.querySelector(".submit-btn");
        submitBtn.innerHTML = `
            <span class="cn">ç«‹å³å‘å¸ƒ</span>
            <span class="en">Publish Now</span>
        `;
    }

    function showFileName() {
        const fileInput = document.getElementById("paperFile");
        const display = document.getElementById("fileNameDisplay");
        if(fileInput.files.length > 0) {
            const fileName = fileInput.files[0].name;
            // æ ¹æ®å½“å‰è¯­è¨€æ˜¾ç¤ºå·²é€‰æ‹©æ–‡æœ¬
            display.innerText = currentLang === 'cn' ? `å·²é€‰æ‹©: ${fileName}` : `Selected: ${fileName}`;
        } else {
            display.innerText = "";
        }
    }

    async function postTweet() {
        const content = document.getElementById("tweetContent").value;
        const fileInput = document.getElementById("paperFile");

        const emptyTip = currentLang === 'cn' ? "è¯·å¡«å†™æè¿°å†…å®¹ï¼" : "Please fill in the description!";
        if (!content.trim()) { alert(emptyTip); return; }

        const formData = new FormData();
        formData.append("content", content);
        formData.append("userId", userId);
        if (fileInput.files[0]) {
            formData.append("file", fileInput.files[0]);
        }

        try {
            const response = await fetch('/api/tweets', {
                method: 'POST',
                body: formData
            });
            const result = await response.text();

            const successText = currentLang === 'cn' ? 'æˆåŠŸ' : 'success';
            const publishSuccessTip = currentLang === 'cn' ? 'å‘å¸ƒæˆåŠŸï¼è¦å»â€˜æˆ‘çš„å†…å®¹â€™æŸ¥çœ‹å—ï¼Ÿ(ç‚¹å‡»å–æ¶ˆç•™åœ¨æœ¬é¡µ)' : 'Published successfully! Do you want to go to "My Content" to check? (Click Cancel to stay on this page)';
            const publishFailTip = currentLang === 'cn' ? 'å‘å¸ƒå¤±è´¥ï¼š' : 'Publish failed: ';
            const networkErrorTip = currentLang === 'cn' ? 'ç½‘ç»œé”™è¯¯' : 'Network error';

            if (result.includes(successText)) {
                if(confirm(publishSuccessTip)) {
                    window.location.href = "dashboard.html"; // æˆ–è€…è·³è½¬åˆ°å†…å®¹ç®¡ç†é¡µ
                } else {
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById("tweetContent").value = "";
                    document.getElementById("paperFile").value = "";
                    document.getElementById("fileNameDisplay").innerText = "";
                }
            } else {
                alert(`${publishFailTip}${result}`);
            }
        } catch (e) {
            alert(networkErrorTip);
        }
    }

    // åˆå§‹åŒ–è¡¨å•æ–‡æœ¬ï¼ˆæ ¹æ®å½“å‰è¯­è¨€ï¼‰
    updateFormText();
</script>
</body>
</html>