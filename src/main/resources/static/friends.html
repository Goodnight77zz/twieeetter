<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>
        <span class="cn">æˆ‘çš„å¥½å‹</span>
        <span class="en">My Friends</span>
    </title>
    <!-- å¼•å…¥é€šç”¨è¯­è¨€ç»„ä»¶CSS -->
    <link rel="stylesheet" href="common/lang-component.css">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f2f5; margin: 0; padding-top: 70px; }

        /* å¯¼èˆªæ é˜²æ­¢æº¢å‡º */
        .navbar {
            position: fixed; top: 0; width: 100%; background: white; height: 60px;
            display: flex; align-items: center; padding: 0 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            box-sizing: border-box; /* å…³é”® */
        }
        .nav-link { margin-right: 20px; text-decoration: none; color: #555; font-weight: bold; font-size: 17px; }

        .container { max-width: 600px; margin: 20px auto; padding: 20px; }
        .page-title { font-size: 20px; font-weight: bold; margin-bottom: 20px; color: #333; }

        /* === æ ¸å¿ƒå¸ƒå±€ä¿®æ”¹ === */
        .user-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between; /* å…³é”®ï¼šè®©å·¦å³ä¸¤è¾¹æ’‘å¼€ */
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* å·¦ä¾§ä¿¡æ¯ç»„ï¼šå¤´åƒ+æ–‡å­— */
        .user-info { display: flex; align-items: center; }

        .avatar { width: 50px; height: 50px; border-radius: 50%; margin-right: 15px; object-fit: cover; }
        .name { font-weight: bold; font-size: 16px; }
        .handle { color: #777; font-size: 13px; }

        /* === è¡¥å…¨æŒ‰é’®æ ·å¼ (è·Ÿæœç´¢é¡µä¸€è‡´) === */
        .followed-btn {
            background: #fff;
            border: 1px solid #cfd9de;
            color: #0f1419;
            padding: 6px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            min-width: 100px; /* å›ºå®šå®½åº¦ï¼Œé˜²æ­¢å˜å­—æ—¶æŠ–åŠ¨ */
            transition: all 0.2s;
        }

        /* é¼ æ ‡æ‚¬åœå˜çº¢ */
        .followed-btn:hover {
            border-color: #f4212e;
            color: #f4212e;
            background-color: #fef2f2;
        }
    </style>
</head>
<body>
<div class="navbar">
    <a href="index.html" class="nav-link">â¬…
        <span class="cn">è¿”å›å¹¿åœº</span>
        <span class="en">Back to Plaza</span>
    </a>
    <a href="search.html" class="nav-link">ğŸ”
        <span class="cn">ç»§ç»­æ‰¾äºº</span>
        <span class="en">Continue Searching</span>
    </a>
</div>

<div class="container">
    <div class="page-title">
        <span class="cn">æˆ‘çš„å…³æ³¨åˆ—è¡¨</span>
        <span class="en">My Following List</span>
    </div>
    <div id="friendList">
        <span class="cn">åŠ è½½ä¸­...</span>
        <span class="en">Loading...</span>
    </div>
</div>

<!-- é€šç”¨è¯­è¨€åˆ‡æ¢ç»„ä»¶HTML -->
<div class="lang-selector" id="langSelector">
    <button class="lang-trigger" id="langTrigger">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 21l5.25-11.25L21 21m-9-3h7.5M3 10.5h7.5M13.5 3H3v7.5" />
        </svg>
    </button>
    <div class="lang-dropdown">
        <button class="lang-option" id="langCn" onclick="switchLang('cn')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
            </svg>
            ä¸­æ–‡
        </button>
        <button class="lang-option" id="langEn" onclick="switchLang('en')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
            </svg>
            English
        </button>
    </div>
</div>

<!-- å¼•å…¥é€šç”¨è¯­è¨€ç»„ä»¶JS -->
<script src="common/lang-component.js"></script>

<script>
    const userId = localStorage.getItem("userId");
    if (!userId) window.location.href = "login.html";

    // å½“å‰è¯­è¨€çŠ¶æ€
    let currentLang = localStorage.getItem('appLang') || 'cn';

    // ç›‘å¬è¯­è¨€åˆ‡æ¢äº‹ä»¶ï¼Œé‡æ–°åŠ è½½åˆ—è¡¨æ›´æ–°æ–‡æœ¬
    window.addEventListener('languageChange', function() {
        currentLang = localStorage.getItem('appLang') || 'cn';
        loadFriends();
    });

    async function loadFriends() {
        const res = await fetch(`/api/users/${userId}/following`);
        const users = await res.json();
        const list = document.getElementById("friendList");
        list.innerHTML = "";

        const noFollowingText = currentLang === 'cn' ? 'ä½ è¿˜æ²¡æœ‰å…³æ³¨ä»»ä½•äººã€‚' : 'You haven\'t followed anyone yet.';
        const followedText = currentLang === 'cn' ? 'å·²å…³æ³¨' : 'Followed';
        const unfollowText = currentLang === 'cn' ? 'å–æ¶ˆå…³æ³¨' : 'Unfollow';

        if (users.length === 0) {
            list.innerHTML = `<div style='text-align:center; color:#777; margin-top:20px;'><span class="cn">${noFollowingText}</span><span class="en">${noFollowingText}</span></div>`;
            return;
        }

        users.forEach(user => {
            const avatar = user.avatar ? `/uploads/${user.avatar}` : 'https://via.placeholder.com/50';
            const nickname = user.nickname || user.username;

            // åŠ äº† user-info çš„åŒ…è£¹å±‚
            list.innerHTML += `
                    <div class="user-card">
                         <div class="user-info"
             onclick="location.href='user_profile.html?id=${user.id}'"
             style="cursor: pointer;">

            <img src="${avatar}" class="avatar">
            <div>
                <div class="name">${nickname}</div>
                <div class="handle">@${user.username}</div>
            </div>
        </div>
                        <button class="followed-btn"
                            onmouseover="this.innerHTML='<span class=\'cn\'>${unfollowText}</span><span class=\'en\'>${unfollowText}</span>'"
                            onmouseout="this.innerHTML='<span class=\'cn\'>${followedText}</span><span class=\'en\'>${followedText}</span>'"
                            onclick="unfollow(${user.id})">
                            <span class="cn">${followedText}</span>
                            <span class="en">${followedText}</span>
                        </button>
                    </div>
                `;
        });
    }

    async function unfollow(targetId) {
        const confirmText = currentLang === 'cn' ? 'ç¡®å®šè¦å–æ¶ˆå…³æ³¨å—ï¼Ÿ' : 'Are you sure you want to unfollow?';
        if(!confirm(confirmText)) return;

        const res = await fetch(`/api/users/${userId}/unfollow?targetUserId=${targetId}`, { method: 'POST' });
        const msg = await res.text();

        const cancelText = currentLang === 'cn' ? 'å·²å–æ¶ˆ' : 'cancelled';
        if (msg.includes(cancelText)) {
            loadFriends();
        } else {
            alert(msg);
        }
    }

    loadFriends();
</script>
</body>
</html>